# 非关系型数据库

> 2023秋，更新中...

## 前言

### NoSQL分类

| 存储类型 | 代表方案 | 说明 |
| :--- | :--- | :--- |
| **列存储** | HBase, Cassandra, Hypertable | 以列簇式存储，将同一列数据存在一起。适用于数据压缩，对一个或几个字段进行查询的效率很高 |
| **文档存储** | MongoDB, CouchDB | 文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有机会对某些字段建立索引，实现关系数据库的某些功能 |
| **key-value存储** | Tokyo Cabinet/Tyrant, Berkeley DB, MemcacheDB, Redis | 可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。 |
| **图存储** | Neo4J, InfoGrid, Infinite Graph | 图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便 |
| 对象数据库 | db4o, Versant | 通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据 |
| XML 数据库 | Berkeley DB XML, BaseX | 高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath |

#### 列存储

与关系模型存储记录不同，列式存储以流的方式在列中存储所有的数据。对于任何记录，索引都可以快速地获取列上的数据。这种存储方式的优点是可以**快速地扫描和分析大量的数据**。

Map-reduce的实现Hadoop的流数据处理效率非常高，列式存储的优点体现的淋漓极致。关系类型的列标对数据分析效果不好，因此，用户经常将更复杂的数据存储在列式数据库中。

> 列式存储支持行检索，但这需要从每个列获取匹配的列值，并重新组成行。这种行检索的效率很低，因此，列式存储一般不支持行检索。

Hbase 的存储粒度是列簇，列簇中包含多个列，列中包含多个版本的数据。Hbase对数据是只增不删的。Row Key 是表中的主键，Row Key 是按照字典顺序存储的，因此，Row Key 的设计非常重要，它直接影响到 Hbase 的读写性能。如下图所示：

![Hbase概念视图](https://s2.loli.net/2023/09/22/XZS7eUByhbwp59J.png)

对于物理存储方式来讲，一个列族的数据是存储在一起的，因此每条数据其实是 `<x, y, timestamp, value>` 的四元组。

#### 文档存储

与键值存储不同的是，文档存储关心文档的内部结构。这使得存储引擎可以直接支持二级索引，从而允许对任意字段进行高效查询。支持文档嵌套存储的能力，使得查询语言具有搜索嵌套对象的能力。

#### 键值存储

#### 图存储

## 数据一致性理论

CAP理论：一个分布式系统不可能满足一致性，可用性和分区容错性这三个需求，最多只能同时满足两个。

- **C**onsistency（一致性）：所有数据的变动都是同步更新的。
- **A**vailability（可用性）：某个节点的宕机不会影响其他节点继续工作。
- Tolerance of network **P**artitions（分区容错性）：能容忍网络分区。

BASE模型：

- **B**asically **A**vailable——基本可用：在分布式系统出现不可预知故障的时候，允许损失部分可用性。

  - 响应时间上的损失：
  - 功能上的损失：
- **S**oft-state：软状态/柔性事物：允许系统中的数据存在中间状态。
- **E**ventually Consistency：最终一致性

### 数据一致性实现技术

#### NWR模型

**N**ode **W**rite **R**ead：

- N（节点数量）
- W（写入时最少的成功写节点数）
- R（读取时最少的成功读节点数）

只需W+R>N即可保证强一致性，因为读取数据的节点和被同步写入的节点是有重叠的。

## 文档型数据库
