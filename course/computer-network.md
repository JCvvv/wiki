# 计算机网络

> 所有在“考试提纲”中提到的专有名词使用黑体加粗。

## 应试

### 考试题目

理论上：

1. 单项选择题（每题1分，共10分），有两道英问题。
2. 填空题（每空1分，共20分）
3. 计算题（每题5分，共10分）
4. 筒答题（每题5分，共15分）
5. 论述题（每题10分，共30分）
6. 综合题（共15分）

> 分数不需要踩点，能写多少写多少，尽可能详细一些。
>
> 可能会有“阅读材料”，但最多只会出现在选择填空里，知道就好。

### 知识点

### 重点题型

## 概述

本章介绍了计算机网络的一系列基本概念，主要包括：

- 网络划分：例如组播、广播，局域、广域网。
- 协议层次：协议、接口与服务之间的关系。
- 面向连接和无连接/可靠和不可靠：对网络服务的一些描述
- 参考模型：OSI 参考模型和 TCP/IP 参考模型。

其他的也很重要，但后面基本都会再次出现。

### 基本概念

**计算机网络**：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，有功能完善的软件实现资源共享和信息传递的系统。

分布式系统：分布式系统是建立在网络之上的软件系统，有高度的内聚性和透明性。

> 内聚性：每一个数据库分布节点高度自治，有本地数据库管理系统
>
> 透明性：每个数据库分布节点对用户应用来说是透明的，用户感觉不到数据是分布的 Internet 是最著名的计算机网络，万维网是最著名的分布式系统，万维网（软件）运行于 Internet（硬件）上

VPN（虚拟专用网）：一种可以将不同地点的单个网络联结成一个扩展网络的技术。

CS：由高性能计算机服务器和普通计算机客户机组成，服务器负责存储数据并处理客户请求，而客户机可远程访问服务器。

**P2P（Peer to Peer network）对等网络**：对等网络又称工作组，网上各台计算机有相同的功能，**无主从之分**，一台计算机都是既可作为服务器，设定共享资源供网络中其他计算机所使用，又可以作为工作站，没有专用的服务器，也没有专用的工作站。**对等网络是小型局域网常用的组网方式**。

### 网络分类

根据**传输模式**，网络可以划分为：

- **广播（broadcasting）**：主机之间**一对所有**的通讯模式，网络对其中每一台主机发出的信号都进行无条件复制并转发，所有主机都可以接收到所有信息（不管你是否需要）。**广播可以看成是一种特殊的组播形式**。

- **多播/组播（multicasting）**：主机之间**一对一组**的通讯模式，也就是加入了同一个组的主机可以接受到此组内的所有数据，网络中的交换机和路由器**只向有需求者复制并转发其所需数据**。

  **主机可以向路由器请求加入或退出某个组**，网络中的路由器和交换机有选择的复制并传输数据，即只将组内数据传输给那些加入组的主机。这样既能一次将数据传输给多个有需要（加入组）的主机，又能保证不影响其他不需要（未加入组）的主机的其他通讯。

- **单播（unicasting）**：主机之间**一对一**的通讯模式，网络中的交换机和路由器对数据只进行转发不进行复制。

根据网络的尺度，网络可以划分为以下几种：

- 个域网（PAN）：允许设备围绕一个人进行通信。一个常见的例子是计算机通过无线网络与其外围设备链接。突出的技术就是蓝牙（bluetooth）。

- **局域网（LAN）**：一种局部地区的私有网络，一般在一座建筑物内或是建筑物附近，比如家庭、办公室或工程。具体分为有线和无线两种。

  局域网有三个特点：距离短、传输速率高、错误率低。

  局域网的组网方式有无线和有线两种：

  1. 无线LAN：每台计算机都有一个**无线调制解调器和一个天线**，用来和其他计算机通信。大多数情况下是和一个设备通信，这个设备称为**接入点（AP， Access Point）、无线路由器或者基站**。这个设备主要负责中继无线计算机之间的数据包，还负责中继无线计算机和 Internet 之间的数据包。代表技术就是 WIFI。
  2. 有线LAN：大多使用铜线作为传输介质，也有一些使用光纤。

  许多有线局域网的拓扑结构是以**点到点链路**为基础的，俗称以太网的**IEEE 802.3是迄今为止最常见的一种有线局域网**。每台计算机按照以太网协议规定的方式运行，通过一条点到点链路链接到一个盒子，这个盒子称**交换机（Switch）**，一台交换机有多个端口，每个端口连接一台计算机。交换机的工作是中继与之连接的计算机之间的数据包，根据数据包中的地址来确定这个数据包要发送给哪台计算机。

  > 局域网的实现技术不止一种，例如在过去就使用过令牌环、FDDI和ARCNET等技术，只是在以太网（由802.3标准规定）推出后被逐渐取代。

- 城域网（MAN）：范围覆盖一个城市。最著名的城域网例子是许多城市都有的有线电视网。

- **广域网（WAN）**：它能跨越很大的地理区域，通常是一个国家、地区或者一个大陆。

其中，广域网的任务是提供长距离通信，运送主机所发送的数据，其覆盖范围通常为几十到几千千米的区域，因而有时也称为远程网，**广域网是因特网的核心部分**；**局域网使用广播技术，而广域网使用交换技术**。

### 网络软件

#### 协议层次结构

**协议层次**：为了降低网络设计的复杂性，大多数网络采用一堆**互相叠加的层（layer / level）**。每一层都建立在他的下层的基础之上，目的都是为其上层提供服务，而实现的具体细节则对上层隐藏。

> 其基本思想是，一段专门的软件（或硬件）向用户提供一种服务，而将内部的状态和算法的细节隐藏起来。相邻的层之间必须要定义**接口（interface）**，以规定下层向上层提供哪些原语操作和服务。这个在进行网络设计时必须考虑清楚，这就需要每个层完成一组特定的有明确含义的功能。

**层和协议的集合即称为网络体系结构（network architecture）**，一个特定的系统所使用的一组协议即称为**协议栈（protocol stack）**。

- **协议**：通信双方就如何进行通信的一种约定。网络协议由**语法、语义和同步**三部分组成。
- **接口**：是同一结点内相邻两层间交换信息的连接点，是一个系统内部的规定。接口定义了**下层向上层提供哪些原语操作和服务**。
- **服务**：是指下层为紧相邻的上层提供的功能调用，由一组原语（primitive）构成的正式说明。
- 对等（实）体：不同机器上构成相应层次的实体称为对等（实）体。

> 此部分可以参考<https://cloud.tencent.com/developer/article/1194830>进行补充。

![服务和协议的关系](https://s2.loli.net/2024/01/02/62B3rZd4HlfnjTX.png)

如上图所示，服务和协议都是“一组规则”（不准确），但是他们描述的分别是垂直关系和水平关系。服务和协议的关系：

1. 服务是指**某一层向它上一层提供的一组原语操作**，服务定义了该层打算代表其用户执行哪些操作，但是他不涉及如何实现这些操作，服务也会涉及到两层之间的接口，其中底层是服务提供者，而上层是服务的用户（上下层之间的联系）。

2. 协议是一组规则，用来规定**同一层上的对等体之间所交换的消息或者分组的格式和含义**。这些实体利用协议来实现他们的服务定义，他们可以自由的改变协议而不影响它提供给上层的服务（对等体之间的规范）。

#### 差错控制

**差错控制（error control）**：是在数字通信中利用编码方法对传输中产生的差错进行控制，以提高数字消息传输的准确性。

#### 流量控制

**流量控制（flow control）**：是指在发送端和接收端之间的点对点通信量的控制。流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来的及接收。

**拥塞控制（congestion control）**：必须确保通信子网能够传送待传送的数据，是一个全局性的问题，涉及网络中所有的主机、路由器以及导致网络传输能力下降的所有因素。

#### 面向连接与无连接服务

在计算机网络中，面向连接和无连接是两种不同的**通信服务模式**。面向对象的连接的服务是按照电话系统建模的，服务用户首先必须建立一个连接，然后使用连接传输数据，最后释放连接，本质上像一个管道；无连接的服务是按照邮政系统建模的，每一个报文都携带者完整的目的地址，每个报文都由系统中的中间节点路由，并且独立于后续的报文。

- **面向连接服务（connection-oriented service）**：通信双方必须**先建立连接，分配相应的资源（如缓冲区）**，以保证通信能够正常进行，传输结束后释放连接和所占用的资源（连接建立，数据传输，连接释放）。
- **无连接服务（connectionless service）**：通信前双方不需要先建立连接，需要发送数据时就直接发送，把每个带有目的地址的包（报文分组）传送到线路上，由系统选定路线进行传输，是一种**不可靠的服务**。

**二者的区别**在于：

1. 面向连接的要求建立连接，因而没有传输的数据没有必要再标明传输的目的地址；而无连接的则对每个报文都由独立的目标地址。
2. 一般来说，面向连接的可靠性较高，协议相对复杂，传输的数据按照发送顺序到达；而无连接的可靠性较差，协议相对简单，常出现乱序，重复和丢失现象。

#### 可靠与不可靠服务

可靠服务即**从来不丢失数据**的一种服务。一般情况下，可靠服务都要求接收方向发送方确认收到的每个报文；不可靠的服务则不会给发送方反馈任何确认消息，不保证数据不丢失。

- 可靠服务：是指网络具有纠错、检错、应答机制，能保证数据正常、可靠地传送到目的地。
- 不可靠服务：是指网络只是尽量正确、可靠地传送，但不能保证数据正确、可靠地传送到目的地，是一种尽力而为的服务。

二者之所以同时存在，原因在于：

- 在给定的层次可靠通信并不总是可以使用的。
- 为了提高可靠服务而导致的固有延迟可能是不可接受的。

**需要注意**：面向连接的服务只是在发送发和接收方之间建立连接，它并不能保证发送的数据流能准确无误的按序到达接收方。**面向连接的服务同样分为可靠的面向连接服务和不可靠的面向连接服务**。其中，前者主要包括报文序列、字节流，后者如数字化语音。

#### OSI模型与TCP/IP模型

OSI（Open System Interconnect）：开放式系统互联，一般都叫OSI参考模型。OSI模型分为七层，由低到高分别为：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层。如下图和下表所示：

![OSI参考模型](https://s2.loli.net/2024/01/02/XxlTVkviHsY8AIn.png)

| 名称       | 数据格式       | 功能                                                         | 设备                 |
| ---------- | -------------- | ------------------------------------------------------------ | -------------------- |
| 物理层     | 二进制比特流   | 1) 相邻两节点之间，实现点到点的传输过程，2) 建立、维护和取消物理连接。 | 光纤、集线器、双绞线 |
| 数据链路层 | 数据帧 Frame   | 保证相邻两节点之间的可靠传输，讲一个原始的传输设施转变成一条逻辑的传输线路。 | 交换机、网卡         |
| 网络层     | 数据包 Packet  | 控制子网运行过程，确定传输路径。                             | 路由器               |
| 传输层     | 数据段 Segment | 为网络层找到的路径提供可靠的传输。                           |                      |
| 会话层     | 数据 Data      | 允许不同机器上的用户之间建立会话。                           |                      |
| 表示层     | 数据 Data      | 关注所传递的信息的语法和语义，取消格式差异。                 |                      |
| 应用层     | 数据 Data      | 包含各种各样的协议。                                         |                      |

TCP/IP协议划分了四层网络，自下而上分别为：

- 网络接入层/链路层：对应OSI参考模型中的物理层和数据链路层，负责监视数据在主机和网络之间的交换。该层主要有地址解析协议（ARP）工作。

  > 事实上，TCP/IP本身并未定义该层的协议，而由参与互连的各网络使用自己的物理层和数据链路层协议，然后与TCP/IP的网络接入层进行连接。

- 互联网/网际互联/网络层：对应OSI参考模型中的网络层，解决主机到主机的通信问题。该层通过重新赋予主机一个IP地址来完成对主机的寻址，负责数据包在多种网络中的路由。该层主要有网际协议（IP）、互联网组管理协议（IGMP）和互联网控制报文协议（ICMP）在工作。

  > IGMP 是允许多个设备共享一个 IP 地址以便它们可以接收相同数据的协议，具体参见<https://www.cloudflare.com/zh-cn/learning/network-layer/what-is-igmp/>。
  >
  > ICMP 的主要目的是报告错误。当两个设备通过互联网连接时，ICMP 会生成错误以与发送设备共享，以防任何数据未到达其预期目的地。详见<https://www.cloudflare.com/zh-cn/learning/ddos/glossary/internet-control-message-protocol-icmp/>

- 传输层：对应 OSI 参考模型的传输层，为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。运行了 TCP 和 UDP。

- 应用层：对应OSI参考模型的高层。

OSI 参考模型与TCP/IP 的关系如下图所示：

![OSI参考模型和TCP/IP模型的对应关系](https://pic3.zhimg.com/80/v2-ec2d34bd1df8809b97a166010e87b05e_1440w.webp)

为了保证网络的互通性，各大国际组织根据自己所关注的领域制定了很多标准。**这些标准总的来说可以分为软件协议标准和硬件连接标准这两大类**。其中软件协议标准主要就是由 IETF 负责的 TCP/IP 协议族相关标准及应用层协议相关标准，硬件连接部分主要就是 IEEE 802 负责的相关标准。

**IEEE 802 的相关标准主要规定了数据链路层和物理层，且将数据链路层又分为了介质访问控制 （MAC） 层 和逻辑链路控制 （LLC） 层 这两层。**其中，前者负责控制网络中的设备如何获得对介质的访问权限和传输数据的权限，后者负责识别和封装网络层协议，并控制错误检查和帧同步。

> 这涉及到本教材中后面两个章节数据链路层和介质访问控制层的来源，二者都属于数据链路层。同时，本教材的参考模型是前一种TCP/IP，也就是区分物理层和数据链路层的版本。

OSI 参考模型和 TCP/IP 模型的相同点：

- 都是建立在协议栈概念上的，并且协议栈中的协议彼此相互独立。
- 两个模型中各个层的功能也大致相似。

不同点：

- OSI采用的七层模型，而TCP/IP是四层结构。

- **TCP/IP参考模型的网络接口层实际上并没有真正的定义，只是一些概念性的描述**。而OSI参考模型不仅分了两层，而且每一层的功能都很详尽，甚至在数据链路层又分出一个介质访问子层，专门解决局域网的共享介质问题。

- OSI模型是在协议开发前设计的，具有通用性；TCP/IP是先有协议集然后建立模型，不适用于非TCP/IP网络。

- OSI参考模型与TCP/IP参考模型的传输层功能基本相似，都是负责为用户提供真正的端对端的通信服务，也对高层屏蔽了底层网络的实现细节。

  所不同的是 **TCP/IP 参考模型的传输层是建立在网络互联层基础之上的，而网络互联层只提供无连接的网络服务，所以面向连接的功能完全在TCP协议中实现**，当然TCP/IP的传输层还提供无连接的服务，如UDP；相反OSI参考模型的传输层是建立在网络层基础之上的，网络层既提供面向连接的服务，又提供无连接的服务，但传输层只提供面向连接的服务。

- OSI参考模型的抽象能力高，适合与描述各种网络；而TCP/IP是先有了协议，才制定TCP/IP模型的。

- OSI参考模型的概念划分清晰，但过于复杂；而TCP/IP参考模型在服务、接口和协议的区别上不清楚，功能描述和实现细节混在一起。

- TCP/IP参考模型的网络接口层并不是真正的一层；OSI参考模型的缺点是层次过多，划分意义不大但增加了复杂性。

- OSI参考模型虽然被看好，由于没把握好时机，技术不成熟，实现困难；相反，TCP/IP参考模型虽然有许多不尽人意的地方，但还是比较成功的。

> **OSI 模型的实力在于模型本身，TCP/IP 模型实力在于协议**。
>
> OSI 模型分为 7 层，明确区分了服务、接口和协议。OSI 模型中的协议具有更好的隐蔽性，也更加的通用。这个模型是在协议之前产生的，它的网络层同时支持无连接和面向连接的通信，但是传输层只支持面向连接的通信。
>
> TCP/IP 模型分为 4 层，没有明确区分服务、接口和协议。通用性差，不适合描述非TCP/IP 网络。TCP/IP 模型是先有的协议后有的模型，协议和模型切合度高。TCP/IP 模型的网络层只支持无连接的通信，但是传输层同时支持两种。

### 参考模型各层的工作环境

> 这部分是对物理层和数据链路层的重新定义和说明。在课程中被放置在数据链路层，这里将内容提前，有助于理解物理层和数据链路层的定义和边界。

数据链路层通常作为**网卡和操作系统驱动程序**实现，网络层（IP协议所在层）通常是操作系统软件。

![计算机中数据链路层的位置](https://s2.loli.net/2024/01/02/Cx3TszBwolaH8Mk.png)

首先明确：网络层、数据链路层和物理层都是独立的进程。接下来，自下而上补充介绍各层的工作环境（五层TCP/IP模型）：

1. 【硬件实现】**物理层**的功能实现驻留在网络接口卡中，主要功能包括按照一定速率将数据转换为信号发送出去和将接收到的信号转换为数据。
2. 【硬件实现】**数据链路层**的功能实现部分分布在网卡中，部分分布在操作系统中。网卡中的数据链路层功能主要包括对发送的数据生成校验和，对接收的数据检查校验和。
3. 【硬件实现】网卡上发送和接收的数据都存放在一个缓冲区中，由网卡上的**物理层和数据链路层进程使用**。
4. 【软件实现】**数据链路层**的部分功能在操作系统中实现，主要包括**可靠性和高效性**所涉及的各种功能。如重传、确认、编号、流量控制、流水等。
5. 【软件实现】**网络层**的功能也在操作系统中实现。
6. 【软件实现】操作系统中发送和接收的数据都存放在操作系统管理的缓冲区中，由位于操作系统中的**数据链路层和网络层进程使用**。
7. 【软件实现】**应用层**有单独的缓冲区。数据需要在**应用层缓冲区和操作系统缓冲区**交换数据。

结合以上七点，可以发现：

1. 该协议栈中提到三个缓冲区，他们分别是：
   - 网卡的缓冲区：网卡上发送和接受的数据，由物理层和数据链路层共同使用。
   - 操作系统的缓冲区：操作系统中发送和接受的数据，由数据链路层和网络层共同使用。
   - 应用层缓冲区：单独的缓冲区，需要喝操作系统的缓冲区交换数据。
2. 数据链路层横跨网卡和操作系统。在网卡中，功能包括生成和检查校验和；操作系统中，包括重传、确认、流量控制等可靠性和高效性的设计。
3. 网卡和操作系统的功能基本如下：
   - 网卡：（数据链路层的）生成、检查校验和；发送和接收数据。
   - 操作系统：（数据链路层的）差错控制和流量控制；网络层的功能；和应用层交换数据。

在这种条件下，将**网卡中的功能合并统称为物理层，操作系统中的功能合并成为数据链路层**。所以，**数据链路层协议不再关心校验和的生成和检查的具体实现**，而是使用一种事件方式提供网卡操作的结果。

## 物理层

计算机网络中的物理层是网络协议栈中的最底层，负责**传输比特流（bitstream）**通过物理媒介进行通信。它处理的是关于如何在物理媒介上传输数据的问题，包括传输介质、电气特性、物理连接和数据传输速率等。

物理层的主要功能包括（这些东西的确都会在课程里介绍）：

1. 传输介质：物理层确定了数据在网络中传输的物理媒介，可以是铜线、光纤、无线电波等。它定义了传输介质的特性，如传输速率、带宽和传输距离等。
2. 电气特性：物理层定义了数据在传输介质上的电气特性，包括电压、电流、时序等。这些特性确保了数据能够正确地在传输介质上传输和接收。
3. 编码和调制：物理层负责将数字数据转换为适合传输介质的模拟信号或数字信号。编码技术可以包括将比特流映射到信号的不同电平或频率，以及添加同步位和校验位等。
4. 物理连接：物理层定义了设备之间的物理连接方式，包括连接器、接口和电缆类型等。它确保设备能够正确地连接并进行数据传输。
5. 时钟同步：物理层需要确保发送方和接收方的时钟保持同步，以便在正确的时间进行数据传输和接收。
6. 基本的数据传输：物理层负责将数据从发送方传输到接收方，通过控制比特流的传输速率、传输模式（全双工、半双工）和数据的流向等。

物理层中自上而下包含了如下几层（看个乐呵就行）：

1. MII介质无关接口
2. PCS物理编码子层
3. PMA物理介质连接层
4. PMD物理介质相关层
5. MDI接口：连接PHY芯片（PHY芯片对应上图红色方框中的部分）和物理介质的接口，常见的是RJ45接口。
6. MEDIUM物理介质：传输介质，双绞线、光纤等等都是。

### 数据通信理论基础

每个给定的信道都有一定的数据传输能力，如何**描述和定义这种数据传输能力**是本节主要的关注点。信道的传输能力可以使用带宽和信道描述：

**带宽（Bandwidth）**：在**传输中不会明显减弱的频率的宽度**，通常引用的带宽是指从$e$到使得接收能量保留一半的那个频率位置，是传输介质的一种物理属性。通常取决于介质的构成、厚度、电线或者光纤的长度。

**信道**：信道是信号的传输媒介。信号在任何物理通道传输的过程中会有能量的损失，尤其是不同频率的信号损失程度不同；**频率越高的信号损失能量越多**。给定一个传输介质，频率高的一些信号成分无法传输到接收方（传输过程中消耗完了）。

信号在信道内传输时，**信号会包含一种或多种频率成分**。其中高于信道截止频率的频率成分将由于能量衰减过多而不能通过信道，通过信道的只能是低于截止频率的成分。传输过程中信号会发生变形，能否准确识别依赖于通信双方的约定（信号发送设备和信号接收设备的）：通信双方需要根据能够传输过去的频率成分考虑合适的调制（编码）和解调制（解码），即什么样的信号对应什么样的比特（组合）。

**信噪比（SNR）**：信号功率$S$与噪声功率 $N$ 的比值，即为信噪比 $\frac{S}{N}$。

**分贝（dB）**：通常把信噪比表示成对数的形式$10\log_{10}{\frac{S}{N}}$，对数的取值单位称为分贝。 信噪比为100可表示力 20dB。

#### 信道的最大数据传输速率

计算信道的最大数据传输速率可以使用尼奎斯特定理（Nyquist theorem）和香农定理（Shannon theorem）。

1. 尼奎斯特定理：用来表示一个**有限带宽的无噪声信道**的最大数据传输率。尼奎斯特定理用于计算理想情况下的最大数据传输速率，即在没有噪声干扰的情况下。根据尼奎斯特定理，信道的最大数据传输速率可以通过以下公式计算：

   $$R_{\text{max}} = 2B \log_2(V)$$

   其中，$R_{\text{max}}$ 表示最大数据传输速率（单位为比特/秒），$B$ 表示信道的带宽（单位为赫兹），$V$ 表示**信号的离散级数**（即离散的幅度或相位级数）。

   尼奎斯特定理告诉我们，通过**增加信号的离散级数或者扩大信道的带宽**，可以提高信道的最大数据传输速率。

2. 香农定理：用来表示**有噪声信道的最大数据传输率或容量**。香农定理用于计算在存在噪声干扰的情况下的最大数据传输速率。根据香农定理，最大数据传输速率可以通过以下公式计算：

   $$C = B \log_2(1 + \text{S/N})$$

   其中，$C$ 表示最大数据传输速率（单位为比特/秒），$B$ 表示信道的带宽（单位为赫兹），$\text{S/N}$ 表示信号与噪声的比值（信噪比）。

   香农定理告诉我们，通过**增加信道的带宽或提高信号与噪声的比值**，可以提高信道的最大数据传输速率。

### 传输介质

常见的有线传输介质如下：

- 磁介质：带宽良好，延迟高。
- 双绞线：将两根线绞在一起，噪音对他们的干扰是一样的，所以他们的**电压差不会改变**，通过电压差来表示信号。双绞线的工作方式有三种：
  1. 全双工：可以同时双向使用。
  2. 半双工：可以双向传输，但每一时刻只允许使用一个方向。
  3. 单工：只允许单向传输。
- 同轴电缆：带宽高，抗噪性好。
- 电力线
- 光纤：分为单模和多模两种。

### 调制和编码

> 这部分和多路复用感觉不好描述，还没写完。

在信号传输过程中，**数据（Data）是指传递（携带）信息的实体**，信息 （Information）则是数据的内容或解释。数据可以分为模拟（Analog）数据与数字（Digital）数据。

信号（Signal）是**数据的物理量编码**（通常为电编码 ），数据以信号的形式传播。信号包括**模拟信号**与**数字信号**，还可以分为**基带（Base band）信号**与**宽带（Broadband ）信号**。

通信系统的传输过程中，通信系统把**携带信息的数据用物理信号形式**通过介质传送到目的地。

> 信息和数据（0、1比特）不能直接在介质上传输。

通信系统自下而上由**信道、信号、数据**三个概念组成。首先是信道，分为数字信道和模拟信道：

- **数字信道**：以数字脉冲形式（离散信号）传输数据的信道。
- **模拟信道**：以连续模拟信号形式传输数据的信道。

与信道相似，信号包括模拟信号和数字信号：

- **模拟信号**：时间上连续，包含无穷多个值。
- **数字信号**：时间上离散，仅包含有限数目的预定值。

数据也有模拟数据和数字数据组成，其中**数字数据**的传输过程有两种：

- **基带传输**：不调制，编码后的数字脉冲信号直接在信道上传送。

  > 例如以太网。

- **频带传输**：调制成模拟信号后再传送，接收方需要解调。

  > 例如通过电话模拟信道传输。

![数据、信号和信道的组合关系](https://s2.loli.net/2024/01/02/6IRAy8VGKnDgS1J.png)

如上图所示，不同类型的信号在不同类型的信道上传输有4种组合，每一种相应地需要进行不同的编码处理。组合情况如下图所示：

![传输过程的组合](https://s2.loli.net/2024/01/02/XN9jnThFOS4sp2R.png)

在四种传输过程中可以分为两种操作：

- 编码：用数字信号承载数字或模拟数据。
- 调制：用模拟信号承载数字或模拟数据。

#### 编码

#### 调制

### 多路复用

复用：多个信息源共享一个公共信道。如下图所示：

![多路复用示意图](https://s2.loli.net/2024/01/02/iP78IQXtNj4uHyc.png)

复用的类型有如下几种：

- FDM（频分复用）
- WDM（波分复用）
- TDM（时分复用）
- CDMA（码分复用）

### PSTN

PSTN ，Public Switched Telephone Network 是一种常用的旧式电话系统，提供的是一个**模拟的专用通道**，通道之间经由若干电环交换机连接而成，当两台主机或路由器需通过PSTN 连接时，必须在网络接入侧使用调制解调器实现信号的模数/数模转换。

电话系统的组成：本地回路、干线上的（多路复用）和交换局的（交换机、交换技术如虚电路交换和分组交换等）。

PSTN作为**早期用户接入互联网的主要方式**，包含了现代网络中的一些主要思想和概念。

> P.S. 许多人可能不知道，在过去（大概05年以前）是通过将电话线插到Modem（调制解调器，但并不是现在的光信号调制解调器）来上网的，这时候还需要在计算机上通过一些程序进行拨号操作，这种方式就是PSTN。

#### 调制技术与ADSL

本地回路关注如何**使用模拟信号尽可能快速的传递数据**。主要设备是调制解调器，调制是将数据转换为模拟信号，解调制是将模拟信号转换为数据。根据发展历史，调制解调器可以分为使用4k带宽的**电话调制解调器**和使用1.1M带宽的**宽带调制解调器**（ADSL调制解调器）。

- 电话调制解调器使用电话的4k带宽，所以电话和数据传输不能同时进行。
- 非对称数字用户线（ADSL，Asymmetric DSL）调制解调器使用本地回路的全部1.1M带宽，电话和数据传输能够同时进行，不过ADSL的上行和下行带宽不对称（**下行速率大于上行速率**，因为大多数用户下载数据量超过上传。）。ADSL采用FDM 把普通的电话线分成电话、上行和下行三个相对独立信道，从而避免相互之间的干扰。
- 光纤到户将本地回路升级为光纤，使用光信号传递数据。每大约100个用户的光纤通过分离器/组合器复合到一根到端局的光纤上，用户之间通过时分多路复用使用到端局的光纤。

#### 干线与复用

中继线是电话系统中的骨干线路，用于连接不同层次的交换局，使用数字信号传输。现在的中继线一般为光纤，能够同时支持多路电话呼叫，采用的主要技术是多路复用技术。

#### 交换

交换局内主要设备是交换机（交换节点），交换机连接多条线路，主要功能是把一条入境线路上来的呼叫交换到一条出境线路上。从而支持呼叫一直到接收方。

- 电路交换是一种面向连接的工作方式。分为三部：使用前建立一条从发送方到接收方的路径；使用这条路径传输；传输完毕释放路径。
- 包（分组）交换是一种非连接的工作方式。数据被分为多个包（分组），每个包包含完整的目的地址。每个包经过交换节点时，交换节点按照当前网络状况（交换表）为其选择一条输出线路。此过程一直持续直到包被传送到目的地。

## 数据链路层

### 介绍

利用物理层提供的**不可靠的比特传输服务（功能）**，在**两台相邻机器之间实现可靠高效的数据通信**的算法和协议。或者可以说成将一条不可靠的物理线路（line）通过协议提升为一条可靠的数据链路（data link）。这其中有三个值得注意的关键词：

- **相邻**：两台机器之间通过一条信道连接起来，**按序到达**是其固有特性。
- **可靠**：接收方接收到的数据和发送方发送的数据一致。
- **高效**：充分利用信道的带宽（传输能力）。

可靠性主要包括两个方面的内容：**差错控制**和**流量控制**。差错控制是为了克服线路误差带来的传输错误；流量控制是为了避免快速的发送方淹没慢速的接收方。

> **淹没**是指发送方发送的太快，使得接收方来不及接收所有的数据，造成数据的丢失。

高效性主要指能够充分利用线路的带宽，主要是**克服线路延迟给可靠传送数据带来的限制**。

数据链路层从网络层获取数据包，将其封装为“**帧头+有效载荷+帧尾**”的帧，因此，数据链路层的核心就是帧的管理。

**帧**：数据链路层对等体之间交换的协议数据单元。关于帧，有这些需要知道的内容：

- 由发送方实体将**从网络层接收到的分组添加额外的字段（协议字段）封装**而成。
- 接收方实体根据协议字段的**取值执行相应的操作（协议算法）**。
- 判定接收的数据正确后，最终**将协议字段去掉，将分组提交给自己所在设备的网络层**。
- 帧的长度是有限制的。每个传输线路都有一定的差错率，帧的最大长度限制是**为了让一个帧在传输过程中出现差错这个现象成为“小概率事件”**，从而易于处理出错的帧。在网络中经常使用重传处理差错。

![数据链路层在参考模型中的位置](https://s2.loli.net/2024/01/02/hACntD87KBdb2wz.png)

数据链路层，可以提供三种可能的服务（就是第一章中提到的有/无连接、可靠/不可靠服务）：

1. 无确认的无连接服务。
2. 有确认的无连接服务。
3. 有确认的有连接服务。

#### 差错控制

在数据链路层，接收方实体需要判断接收的帧是否在传输过程中出现了错误。如果没有传输错误，则将帧中包含的分组提交给网络层。否则，需要发送方重传这一帧。帧的数据取值可能没有任何特征，这时需要添加额外的位来凑出某种或某几种特征，通过检验特征是否存在来判断数据传输是否正确。

**校验和**：通信双方为了对传输的数据进行**检错和纠错**而根据一定的规则添加的**额外的位**（组合）。

> 校验和是可以用来进行纠错的。

重传的相关概念：

- **重传**：当某一帧在传输过程中出现错误时，网络中常用的处理方法是发送方重传这一帧，而不是接收方使用纠错算法纠正错误。
- **确认**：接收方对自己所接收正确的帧回复一个确认，使得接收方也能知道这一帧已经被正确传输。
- **重传定时器**：为了避免发送方长时间地等待确认，根据线路延迟等要素估计一个确认能够返回的时间，设置为重传定时器。当等待时间超过这个时间时，则认为确认无法回来，重发这一帧。
- **编号**：为每个传递的帧确定一个编号，从而区别不同的帧。

#### 流量控制

流量控制用于防止快速的发送淹没低速的接受者。**流量控制是可靠性传输的必要条件；不可靠的传输有时也需要流量控制**。

常见的流量控制机制有两种：

- **基于反馈**的流量控制（隐式，非明确指明）。

- **基于速率**的流量控制（显示，明确指明）。

  > 基于速率的流量控制通过显式限制发送方的发送速率实现。

流量控制技术中保证高效性的三个方式：

- **流水发送**：为了避免一帧传递完后再传递下一帧带来的线路带宽的浪费，尤其是在线路较长时， 发送方可以流水发送多帧。这需要发送方有多个缓冲区来缓存已经发送还没有收到确认的帧（没有传输完成的帧）。
- **捎带确认**：为了避免单独的确认帧浪费资源，将确认使用接收方发送的数据帧携带。这要求双工通信。
- **批量确认**：在流水场景中，接收方收到多个帧时返回一个确认，从而减少确认帧的个数。尽最大可能不触发己正确接收帧的重传。

#### 成帧

成帧的主要工作是将每一段来自上层的数据封装起来，使得数据链路层的接收方实体能够**正确识别一个帧的开始和结束（能够确定帧的边界）**，并能依据帧中携带的各种**控制字段（额外添加的协议字段）判断所接收帧的正确性（是否在传输过程中出错、是否是想要的那一帧）**。

确定帧的边界有一些基本的要求：容易识别一个帧的开始和结束（出错时容易同步）；开销尽可能少。

成帧有四种主要的方法：

1. **字节计数法**：利用头部中的一个字段来标识该帧中的字符数。当目的节点的数据链路层收到字节计数值时就知道后面跟随的字节数，从而可以确定帧结束的位置。

   > 问题：如果**计数字段出错，即失去了帧边界划分的依据**，接收方就无法判断所传输帧的结束位和下一帧的开始位，收发双方将失去同步，从而造成灾难性的后果。

2. **字节填充的标志字节法**：使用一些**特定的字符**来界定一帧的开始与结束。发送方的数据链路层在数据中“偶尔”出现的每个标识字节的前面插入一个特殊的**转义字节（ESC）**。接收方的数据链路层在将数据传递给网络层之前必须删除转移字节，这种技术成为字节填充。

3. **比特填充的标志比特法**：使用一个**特定的比特模式**，即`01111110`来标志一帧的开始和结束。为了不使信息位中出现比特流`01111110`被误判为帧的首尾标志，发送方的数据链路层在信息位中遇到5个连续的`1`时，将自动在其后插入一个`0`；而接收方做该过程的逆操作，即收到5个连续的`1`时，则自动删除后面紧跟的`0`，以恢复原信息。

   > 问题：采用2、3两种方法时，**一帧的长度要取决于它所携带的数据内容**。

4. **物理层编码违禁法**：使用“不会出现在常规数据中”的余比特作边界。好处是除了开始和结束的填充外， 不再需要填充额外的数据。

### 错误检测和纠正

循环校验码（CRC），自己学。

### 基本数据链路协议

基本的数据链路层协议（也就是**停等协议**）有三种：

1. 无约束单工协议：工作在理想情况。
2. （无错信道上的）单工停等协议：增加接收方不能无休止接收的约束，解决方案是接收方每收到一个帧后，给发送方回送一个响应。
3. 有噪声/有错信道的单工停等协议：增加信道（线路）有差错，信息帧可能损坏或丢失的约束，解决方案是出错重传。

#### 有错信道的单工停等协议

在该协议中，出错重传的解决方案本身带来了三个问题：

- 什么时候重传 --> 定时。
- 响应帧损坏怎么办（重复帧） --> 发送帧头中放入序号。
- 为了使帧头精简，序号取多少位 --> 1位。

发送方在发下一个帧之前等待一个肯定确认的协议叫做**PAR（Positive Acknowledgement with Retransmission）或ARQ（Automatic Repeat reQuest）**。

下面的描述字很多，但没有什么问题，日后可以补充一些图辅助说明：

1. 该协议增加了一个计时器，发送方发出一帧，接收方只有在正确接收到数据之后才返回一个确认帧。如果到达接收方的是一个已经损坏的帧则将它丢弃，经过一段时间后发送方将超时，于是它再次发送该帧。这个过程将不断重复，直至该帧完好无损地到达接收方。
2. 发送方在它所发送的每个帧的头部放上一个序号，然后，接收方可以检查它所接收到的序号，由此判断这个帧是新帧还是应该被丢弃的重复帧。
3. 如果到达了一个有效确认帧，则发送方从它的网络层获取下一个数据包，并把它放入缓冲区覆盖掉原来的包，同时他还会递增帧的序号。如果到达了一个受损的确认帧，或者计时器超时，则缓冲区和序号都不作任何改变，以便重传原来的帧。
4. 当一个有效帧到达接收方时，接收方首先检查它的序号，确定是否为重复数据包。如果不是，则接收该数据包并将它传递至网络层，然后生成一个确认帧。重复帧和受损帧都不会被传递给网络层，但它们的到来会导致最后一个正确接收到的数据帧的确认被重复发送，返回给发送方，以便发送方做出前进到下一帧或重发那个受损帧的决策。

### 滑动窗口协议

滑动窗口协议在基本数据链路协议的基础上，将单工通信提升到全双工通信，充分利用了通信带宽。其实现主要涉及三个基本概念：

- **捎带确认（piggybacking）**：暂时延缓确认以便将确认信息搭载在下一个出境数据帧上的技术。
- **发送窗口（sending window）**：在任何时刻发送方总维持着一组连续的允许发送的帧的序号。
- **接受窗口（receiving window）**：接收方维持着一组连续的允许接收帧的序号。

> 滑动窗口协议允许数据包不按次序到达，但接收机数据链路层协议将数据包递交给网络层的次序必须与发送机上数据包从网络层被传递给数据链路层的次序相同。

滑动窗口协议总共有三种，他们都能在实际（非理想）环境下正常工作，区别仅在于效率、复杂性和对缓冲区的要求，他们分别为：

- 1-bit 滑动窗口协议（发送窗口大小=1，接收窗口大小=1）：
- N-Back 协议（发送窗口大小>1，接收窗口大小=1）：
- 选择重传协议（发送窗口大小>1，接收窗口大小>1）：

## 介质访问子层

### 静态和动态信道分配

### 多路访问协议

### 以太网

### WLAN

### 数据链路层交换

## 网络层

### 网络层设计要点

### 路由算法

### 拥塞控制

### 服务质量

### 网络互连

### Internet网络层

## 传输层

### 传输协议的要素

### UDP

### TCP

## 应用层

### DNS协议

## 参考资料

- [计算机网络-物理层 - 知乎](https://zhuanlan.zhihu.com/p/520426633)
